{% load static %}
{% load dynforms %}
{% load samples_tags %}
<link href="{% static 'samples/sample.min.css' %}" rel="stylesheet"/>

<div class="controls " id="{{field.name}}-controls" data-field-name="{{field.name}}">
	<div class="row no-space hazard-controls" id="sample-hazard-controls">
		{% get_pictograms as pictograms %}
			{% for pic in pictograms %}
		    <label class="checkbox pictogram pull-left col-sm-6 col-md-4 col-lg-3">
		    	<input name="{{field.name}}"
		       	id="{{field.name}}_{{forloop.counter}}"
		       	value="{{pic.pk}}"
		       	{% if pic.pk in data %}checked="checked"{% endif %}
		       	type="checkbox">
		       	<div class="hazard-input media"
				    data-bs-toggle="popover"
				    data-placement="bottom"
				    data-trigger="hover"
				    data-content="{{pic.description}}">
					<img class="media-object pull-left" src="{% pictogram_url pic %}" alt="{{pic.code}}">
					<div class="media-body">{{pic.name}}</div>
                </div>
			</label>
			{% endfor %}
	</div>
</div>
<script type="text/javascript">

    $(document).on('uso:samples-changed', function (e, data) {
        let allHazards = data.hazards || [];
        //reset all checkboxes
        $('#{{field.name}}-controls input[type="checkbox"]').removeAttr('checked');


        // check new ones
        $.each([...allHazards], function (index, value) {
            $(`#{{field.name}}-controls input[value="${value}"]`).attr('checked', 'checked');
        });

        // manage non-hazard checkbox
        let $nonHazard = $('{{ field.name }}-controls  input[type="checkbox"][value="15"]');
        if (jQuery.isEmptyObject(allHazards)) {
            $nonHazard.removeAttr("disabled");
        } else {
            $nonHazard.attr("disabled", "disabled");
        }
    });


    $(document).ready(function () {
        // clear hazards if "not hazardous" selected, and vice-versa
        const nonHazardID = "15";
        const inputSelector = `#{{field.name}}-controls input[name="{{field.name}}"]`;
        const hazardSelector = `:not(input[value="${nonHazardID}"])`;
        const nonHazardSelector = `[value="${nonHazardID}"]`;

        $(inputSelector).filter(hazardSelector).change(function(){
            if (this.checked) {
                $(inputSelector).filter(nonHazardSelector).each(function(){
                    $(this).removeAttr('checked');
                    $(this).prop('checked', false);
                });
            }
        });
        $(inputSelector).filter(nonHazardSelector).change(function(){
            if (this.checked) {
                $(inputSelector).filter(hazardSelector).each(function(){
                    $(this).removeAttr('checked');
                    $(this).prop('checked', false);
                });
            }
        });
    });



</script>
